Zilog eZ8 Encore! Macro Assembler Version 2.53 (14010603) 04-Jul-15     17:49:38     page:   1


PC     Object              I  Line    Source 
                           A     1    ; Filename: monovideo4.asm
                           A     2    ; Author: Koen van Vliet <8by8mail@gmail.com>
                           A     3    ; Description: Test with monochrome video using
                           B     0    include "ez8.inc"
                           B     1    ;**********************************************
                           B     2    ;*  Copyright (C) 1999-2006 by  Zilog, Inc.
                           B     3    ;*  All Rights Reserved
                           B     4    ;**********************************************
                           B     5    
                           B   955    	.list on
                           B   956    
                           B   957    
                           A     5    
                           A     6    ; Setup video generator
     01312D00              A     7    		sysFreq		equ		20_000_000 
     00000032              A     8    		rFreq		equ		50
                           A     9    
     00000015              A    10    		hChars		equ		21			; Chara
     0000001E              A    11    		vChars		equ		30			; Chara
     00000002              A    12    		hBorderL	equ		2			; Left 
     00000002              A    13    		hBorderR	equ		2			; Right
     00000007              A    14    		cWidth		equ		7			; Width
     00000008              A    15    		cHeight		equ		8			; Heigh
                           A    16    
     00000003              A    17    		spiPre		equ	3
                           A    18    
                           A    19    ; Calculate timing parameters
     00000016              A    20    		hCharsTotal equ	hChars + 1;3 ;+ hBorder
                           A    21    		if (hCharsTotal / 2) * 2 < hCharsTotal
                           A    22    			error "Horizontal characters must b
                           A    23    		endif
                           A    24    		
                           A    25    		if rFreq = 50
     00000040              A    26    			hTime		equ		64
     00000004              A    27    			hSyncTime	equ		4
     00000004              A    28    			bPorchTime	equ		4
     00000002              A    29    			fPorchTime	equ		2
     00000005              A    30    			vSyncHLines	equ		5
     00000001              A    31    			vSyncPad	equ		1;1
                           A    32    		elseif rFreq = 60
                           A    33    			hTime		equ		63
                           A    34    			hSyncTime	equ		4
                           A    35    			bPorchTime	equ		4
                           A    36    			fPorchTime	equ		2
                           A    37    			vSyncHLines	equ		6
                           A    38    			vSyncPad	equ	0
                           A    39    		else
                           A    40    			error	"Unknown frequency"
                           A    41    		endif
                           A    42    
     0000003A              A    43    		t0Interval		var		hTime * sysFreq
     00000050              A    44    		t1hSync			equ		hSyncTime * sys
Zilog eZ8 Encore! Macro Assembler Version 2.53 (14010603) 04-Jul-15     17:49:38     page:   2


PC     Object              I  Line    Source C:\users\koen\MY_D~D41\src\ez8\MONO~MM3\monovideo4.asm
     0000022E              A    45    		t1BroadSync		equ		(t0Interval * (
                           A    46    
                           A    47    		if t0Interval < (cWidth + 1) * spiPre *
                           A    48    			error "Horizontal character count t
                           A    49    		endif
                           A    50    		
                           A    51    ;Register labels (R4-R8 are free to use)
     00000001              A    52    		DDR			equ		1
     00000002              A    53    		AF			equ		2
                           A    54    
                           A    55    		vBuff		equ		RR10
                           A    56    		vBuffH		equ		R10
                           A    57    		vBuffL		equ		R11
                           A    58    		isrVect		equ		RR14
                           A    59    		isrVectH	equ		R14
                           A    60    		isrVectL	equ		R15
                           A    61    		hCharCnt	equ		R12
                           A    62    		vLineCnt	equ		R13
                           A    63    		state		equ		R9
                           A    64    		
     00000200              A    65    		screenBuff	equ		200h
                           A    66    
0002 0200                  A    67    vector	RESET = init
000C 0296                  A    68    vector timer0 = isrT0
                           A    69    org 0200h
0200 8F                    A    70    init		di									0201 0100                  A    71    			srp		#00h						0203 E9000FFE              A    72    			ldx		SPH,#00h					0207 E9FF0FFF              A    73    			ldx		SPL,#FFh
020B 6C02                  A    74    			ld		R6,#2
020D D6 027D               A    75    			call	clrBuff						                           A    76    			
0210 E9010FD8              A    77    initSpi		ldx		PCADDR,#DDR					0214 E9EF0FD9              A    78    			ldx		PCCTL,#~(1<<4)
0218 E9020FD8              A    79    			ldx		PCADDR,#AF					021C E9100FD9              A    80    			ldx		PCCTL,#(1<<4)				0220 E9030F61              A    81    			ldx		SPICTL,#(1<<1)|(1<<0)		0224 E91C0F63              A    82    			ldx		SPIMODE,#((cWidth & 7) << 2
0228 E9000F66              A    83    			ldx		SPIBRH,#HIGH(spiPre)		022C E9030F67              A    84    			ldx		SPIBRL,#LOW(spiPre)
                           A    85    
0230 E9000F07              A    86    			ldx		T0CTL1,#0					0234 E9000F06              A    87    			ldx		T0CTL0,#0					0238 E9000F02              A    88    			ldx		T0RH,#HIGH(t0Interval)		023C E93A0F03              A    89    			ldx		T0RL,#LOW(t0Interval)		0240 E9010F07              A    90    			ldx		T0CTL1,#(1<<0)				0244 E9200FC1              A    91    			ldx		IRQ0ENH,#(1<<5)				0248 E9200FC2              A    92    			ldx		IRQ0ENL,#(1<<5)
                           A    93    			
024C E9000F0F              A    94    			ldx		T1CTL1,#0					0250 E9000F0E              A    95    			ldx		T1CTL0,#0					0254 E9000F0A              A    96    			ldx		T1RH,#HIGH(t1hSync)			Zilog eZ8 Encore! Macro Assembler Version 2.53 (14010603) 04-Jul-15     17:49:38     page:   3


PC     Object              I  Line    Source C:\users\koen\MY_D~D41\src\ez8\MONO~MM3\monovideo4.asm
0258 E9500F0B              A    97    			ldx		T1RL,#LOW(t1hSync)
025C E9400F0F              A    98    			ldx		T1CTL1,#(1<<6)				                           A    99    
0260 E9020FD8              A   100    initGPIO	ldx		PCADDR,#AF					0264 49020FD9              A   101    			orx		PCCTL,#(1<<1)			
                           A   102    			
0268 4CC0                  A   103    startVideo	ld		R4,#C0h
026A 5C0D                  A   104    			ld		R5,#0Dh
026C 9C 12                 A   105    			ld		state,#LOW(preEq)			026E CC0A                  A   106    			ld		hCharCnt,#hChars/2
0270 DC06                  A   107    			ld		vLineCnt,#vSyncHLines + vSy
0272 EC 03                 A   108    			ld		isrVectH,#HIGH(sync)
0274 FC 00                 A   109    			ld		isrVectL,#LOW(sync)
0276 49800F07              A   110    			orx		T0CTL1,#(1<<7)				027A 9F                    A   111    			ei									                           A   112    			
027B                       A   113    $$			; Do stuff
027B 8B FE                 A   114    			jr		$B
                           A   115    
027D 0C02                  A   116    clrBuff		ld		R0,#HIGH(screenBuff)
027F 1C00                  A   117    			ld		R1,#LOW(screenBuff)
0281 E4E1E2                A   118    $$			ld		R2,R1
0284 56E23F                A   119    			and		R2,#63
0287 96E2E0                A   120    			ldx		@RR0,R2
028A A0E0                  A   121    			incw	RR0
028C A6E176                A   122    			cp		R1,#LOW(screenBuff+hChars*v
028F 1FA6E004              A   123    			cpc		R0,#HIGH(screenBuff+hChars*
0293 EB EC                 A   124    			jr		ne,$B
0295 AF                    A   125    			ret
                           A   126    
0296 C4EE                  A   127    isrT0		jp		@isrVect
                           A   128    
                           A   129    align 256
0300 59BF0F0F              A   130    sync		andx	T1CTL1,#~(1<<6)				0304 49800F0F              A   131    			orx		T1CTL1,#(1<<7)				0308 49400F0F              A   132    			orx		T1CTL1,#(1<<6)
030C E4E9EF                A   133    			ld		isrVectL,state
030F BCFF                  A   134    			ld		vBuffL,#FFh					0311 BF                    A   135    			iret
                           A   136    ; Pre-equalizing pulses
0312 CA 10                 A   137    preEq		djnz	hCharCnt,preEqEnd
0314 DA 0A                 A   138    			djnz	vLineCnt,$F
0316 9C 25                 A   139    			ld		state,#LOW(vertPad)			0318 E4E5ED                A   140    			ld		vLineCnt,R5
031B CC15                  A   141    			ld		hCharCnt,#hChars
031D FC 00                 A   142    			ld		isrVectL,#LOW(sync)
031F BF                    A   143    			iret
0320 CC0A                  A   144    $$			ld		hCharCnt,#hChars/2
0322 FC 00                 A   145    			ld		isrVectL,#LOW(sync)
0324 BF                    A   146    preEqEnd	iret
                           A   147    
                           A   148    ; Vertical padding
Zilog eZ8 Encore! Macro Assembler Version 2.53 (14010603) 04-Jul-15     17:49:38     page:   4


PC     Object              I  Line    Source C:\users\koen\MY_D~D41\src\ez8\MONO~MM3\monovideo4.asm
0325 CA 14                 A   149    vertPad		djnz	hCharCnt,vertPadEnd
0327 DA 0E                 A   150    			djnz	vLineCnt,$F
0329 9C 3C                 A   151    			ld		state,#LOW(fetch)			032B E4E4ED                A   152    			ld		vLineCnt,R4
032E CC15                  A   153    			ld		hCharCnt,#hChars
0330 FC 00                 A   154    			ld		isrVectL,#LOW(sync)
0332 2C02                  A   155    			ld		R2,#HIGH(screenBuff)		0334 3C00                  A   156    			ld		R3,#LOW(screenBuff)
0336 BF                    A   157    			iret
0337 CC0A                  A   158    $$			ld		hCharCnt,#hChars/2
0339 FC 00                 A   159    			ld		isrVectL,#LOW(sync)
033B BF                    A   160    vertPadEnd	iret
                           A   161    
                           A   162    ; Visible display
033C 94BF60                A   163    fetch		ldx		SPIDATA,vBuffL
033F CA 26                 A   164    			djnz	hCharCnt,fetchTile			0341 26E315                A   165    			sub		R3,#hChars					0344 36E200                A   166    			sbc		R2,#0
0347 DA 0A                 A   167    			djnz	vLineCnt,$F					0349 9C 7A                 A   168    			ld		state,#LOW(vertPad2)		034B E4E5ED                A   169    			ld		vLineCnt,R5
034E CC15                  A   170    			ld		hCharCnt,#hChars
0350 FC 00                 A   171    			ld		isrVectL,#LOW(sync)
0352 BF                    A   172    			iret
0353 E4EDE0                A   173    $$			ld		R0,vLineCnt
0356 E0E0                  A   174    			rr		R0
0358 56E007                A   175    			and		R0,#07h
035B EB 06                 A   176    			jr		ne,$F						035D 06E315                A   177    			add		R3,#hChars					0360 16E200                A   178    			adc		R2,#0
0363 CC15                  A   179    $$			ld		hCharCnt,#hChars
0365 FC 00                 A   180    			ld		isrVectL,#LOW(sync)
0367 E4EDE0                A   181    fetchTile	ld		R0,vLineCnt
036A E0E0                  A   182    			rr		R0
036C 56E007                A   183    			and		R0,#07h						036F 46E0 10               A   184    			or		R0,#HIGH(charSet)			0372 86E2E1                A   185    			ldx		R1,@RR2						0375 A0E2                  A   186    			incw	RR2							0377 C2B0                  A   187    			ldc		vBuffL,@RR0					                           A   188    			;ld		vBuffL,vLineCnt
0379 BF                    A   189    			iret
                           A   190    			
                           A   191    ; Vertical padding bottom
037A CA 0F                 A   192    vertPad2	djnz	hCharCnt,vertPad2End
037C DA 09                 A   193    			djnz	vLineCnt,$F
037E 9C 8C                 A   194    			ld		state,#LOW(postEq)			0380 DC05                  A   195    			ld		vLineCnt,#vSyncHLines
0382 CC0A                  A   196    			ld		hCharCnt,#hChars/2
0384 FC 00                 A   197    			ld		isrVectL,#LOW(sync)
0386 BF                    A   198    			iret
0387 CC0A                  A   199    $$			ld		hCharCnt,#hChars/2
0389 FC 00                 A   200    			ld		isrVectL,#LOW(sync)
Zilog eZ8 Encore! Macro Assembler Version 2.53 (14010603) 04-Jul-15     17:49:38     page:   5


PC     Object              I  Line    Source C:\users\koen\MY_D~D41\src\ez8\MONO~MM3\monovideo4.asm
038B BF                    A   201    vertPad2End	iret
                           A   202    
                           A   203    ; Post-equalizing pulses
038C CA 12                 A   204    postEq		djnz	hCharCnt,postEqEnd
038E DA 0C                 A   205    			djnz	vLineCnt,$F
0390 9C A1                 A   206    			ld		state,#LOW(vSync)			0392 DC05                  A   207    			ld		vLineCnt,#vSyncHLines
0394 E9020F0A              A   208    			ldx		T1RH,#HIGH(t1BroadSync)		0398 E92E0F0B              A   209    			ldx		T1RL,#LOW(t1BroadSync)
039C CC0A                  A   210    $$			ld		hCharCnt,#hChars/2
039E FC 00                 A   211    			ld		isrVectL,#LOW(sync)
03A0 BF                    A   212    postEqEnd	iret
                           A   213    ; Broad sync pulses
03A1 CA 12                 A   214    vSync		djnz	hCharCnt,vSyncEnd
03A3 DA 0C                 A   215    			djnz	vLineCnt,$F
03A5 9C 12                 A   216    			ld		state,#LOW(preEq)			03A7 DC06                  A   217    			ld		vLineCnt,#vSyncHLines + vSy
03A9 E9000F0A              A   218    			ldx		T1RH,#HIGH(t1hSync)			03AD E9500F0B              A   219    			ldx		T1RL,#LOW(t1hSync)
03B1 CC0A                  A   220    $$			ld		hCharCnt,#hChars/2
03B3 FC 00                 A   221    			ld		isrVectL,#LOW(sync)
03B5 BF                    A   222    vSyncEnd	iret
                           A   223    
                           A   224    
                           A   225    org 1000h										1000                       A   226    charSet											1000 FFFFFFFF FFFFFFFF     A   227    		byte FFh,FFh,FFh,FFh,FFh,FFh,FFh,FFh,FF
1008 FFFFFFFF 9FFFFFFF 
1010 FFFFFFFF FFFFFFFF 
1018 FFFFFFFF FFFFFFFF 
1020 FFFFFFFF FFFFFFFF 
1028 FFFFFFFF FFFFFFFF 
1030 FFFFFFFF FFFFFFFF 
1038 FFFFFFFF FFFFFFFF 
                           A   228    org 1100h
1100 FFE7FF93 CF7381FF     A   229    		byte FFh,E7h,FFh,93h,CFh,73h,81h,FFh,E7
1108 E7E7FFFF CFFFCF3F 
1110 87030387 F38787CF 
1118 8383FFCF E3FFC7CF 
1120 87330787 0F033F87 
1128 33878F33 03393387 
1130 3FE33387 CF87CF39 
1138 33CF0387 F9E1FF03 
                           A   230    org 1200h
1200 FFFFFF93 073333FF     A   231    		byte FFh,FFh,FFh,93h,07h,33h,33h,FFh,CF
1208 CFF399E7 CFFFCF9F 
1210 33CF9F33 F33333CF 
1218 3939FFE7 CFFFF3FF 
1220 3B333333 273F3F33 
1228 33CF2727 3F393333 
1230 3F872733 CF338711 
1238 33CF3F9F F3F9FFFF 
Zilog eZ8 Encore! Macro Assembler Version 2.53 (14010603) 04-Jul-15     17:49:38     page:   6


PC     Object              I  Line    Source C:\users\koen\MY_D~D41\src\ez8\MONO~MM3\monovideo4.asm
                           A   232    org 1300h
1300 FFFFFF01 F39F31FF     A   233    		byte FFh,FFh,FFh,01h,F3h,9Fh,31h,FFh,9F
1308 9FF9C3E7 FFFFFFCF 
1310 33CFCFF3 01F333CF 
1318 39F9E7E7 9F83F9CF 
1320 3F33333F 333F3F33 
1328 33CFE70F 3F392333 
1330 3F330FF3 CF333301 
1338 87CF9F9F E7F9FFFF 
                           A   234    org 1400h
1400 FFE7FF93 87CF8FFF     A   235    		byte FFh,E7h,FFh,93h,87h,CFh,8Fh,FFh,9F
1408 9FF90081 FF83FFE7 
1410 13CFE7C7 33F307CF 
1418 8381FFFF 3FFFFCE7 
1420 2303073F 330F0F23 
1428 03CFE71F 3F290333 
1430 07330787 CF333329 
1438 CF87CF9F CFF9BBFF 
                           A   236    org 1500h
1500 FFE79901 3FE787CF     A   237    		byte FFh,E7h,99h,01h,3Fh,E7h,87h,CFh,9F
1508 9FF9C3E7 FFFFFFF3 
1510 238FF3F3 C3073FE7 
1518 3939FFFF 9F83F9F3 
1520 2333333F 333F3F3F 
1528 33CFE70F 3F010333 
1530 3333333F CF333339 
1538 8733E79F 9FF993FF 
                           A   238    org 1600h
1600 FFE79993 833333E7     A   239    		byte FFh,E7h,99h,93h,83h,33h,33h,E7h,CF
1608 CFF399E7 FFFFFFF9 
1610 33CF3333 E33F3333 
1618 3939E7E7 CFFFF333 
1620 33873333 273F3F33 
1628 33CFE727 3F111333 
1630 33333333 CF333339 
1638 3333F39F 3FF9C7FF 
                           A   240    org 1700h
1700 FFE79993 CF3B87F3     A   241    		byte FFh,E7h,99h,93h,CFh,3Bh,87h,F3h,E7
1708 E7E7FFFF FFFFFFFF 
1710 87CF8787 F3038703 
1718 8383FFFF E3FFC787 
1720 87CF0787 0F030387 
1728 3387C333 3F393387 
1730 07870787 03333339 
1738 33330387 FFE1EFFF 
                           A   242    
                           A   243    if vSync - sync > 200
-----WARNING (507) Unexpected relocatable boolean/relational operand(s)
                           A   244    	warning "vSync label almost out of reach!"	                           A   245    endif											                           A   246    			
Zilog eZ8 Encore! Macro Assembler Version 2.53 (14010603) 04-Jul-15     17:49:38     page:   7


PC     Object              I  Line    Source 


Errors: 0
Warnings: 1
Lines Assembled: 2356
