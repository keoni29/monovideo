Zilog eZ8 Encore! Macro Assembler Version 2.53 (14010603) 03-May-15     22:14:18     page:   1


PC     Object              I  Line    Source 
                           A     1    ; Filename: monovideo3.asm
                           A     2    ; Author: Koen van Vliet <8by8mail@gmail.com>
                           A     3    ; Description: Test with monochrome video using
                           B     0    include "ez8.inc"
                           B     1    ;**********************************************
                           B     2    ;*  Copyright (C) 1999-2006 by  Zilog, Inc.
                           B     3    ;*  All Rights Reserved
                           B     4    ;**********************************************
                           B     5    
                           B   955    	.list on
                           B   956    
                           B   957    
                           A     5    
                           A     6    ; Setup video generator
     01312D00              A     7    		sysFreq		equ		20_000_000
     00000032              A     8    		rFreq		equ		50
                           A     9    
     00000017              A    10    		hChars		equ		23			; Chara
     0000001A              A    11    		vChars		equ		26			; Chara
     00000002              A    12    		hBorderL	equ		2			; Left 
     00000002              A    13    		hBorderR	equ		2			; Right
     00000008              A    14    		cWidth		equ		8			; Width
     00000008              A    15    		cHeight		equ		8			; Heigh
                           A    16    
     00000002              A    17    		spiPre		equ	2
                           A    18    
                           A    19    ; Calculate timing parameters
     0000001E              A    20    		hCharsTotal equ	hChars + 3 + hBorderL +
                           A    21    		if (hCharsTotal / 2) * 2 < hCharsTotal
                           A    22    			error "Horizontal characters must b
                           A    23    		endif
                           A    24    		
                           A    25    		if rFreq = 50
     00000040              A    26    			hTime		equ		64
     00000004              A    27    			hSyncTime	equ		4
     00000004              A    28    			bPorchTime	equ		4
     00000002              A    29    			fPorchTime	equ		2
     00000005              A    30    			vSyncHLines	equ		5
     00000001              A    31    			vSyncPad	equ	1
                           A    32    		elseif rFreq = 60
                           A    33    			hTime		equ		63
                           A    34    			hSyncTime	equ		4
                           A    35    			bPorchTime	equ		4
                           A    36    			fPorchTime	equ		2
                           A    37    			vSyncHLines	equ		6
                           A    38    			vSyncPad	equ	0
                           A    39    		else
                           A    40    			error	"Unknown frequency"
                           A    41    		endif
                           A    42    
     0000002A              A    43    		t0Interval		var		hTime * sysFreq
     00000050              A    44    		t1hSync			equ		hSyncTime * sys
Zilog eZ8 Encore! Macro Assembler Version 2.53 (14010603) 03-May-15     22:14:18     page:   2


PC     Object              I  Line    Source C:\users\koen\MY_D~D41\src\ez8\MONO~MM3\monovideo4.asm
     00000226              A    45    		t1BroadSync		equ		(t0Interval * (
                           A    46    
                           A    47    		if t0Interval < (cWidth + 1) * spiPre *
                           A    48    			error "Horizontal character count t
                           A    49    		endif
                           A    50    		
                           A    51    ;Register labels
     00000001              A    52    		DDR			equ		1
     00000002              A    53    		AF			equ		2
                           A    54    
                           A    55    		vBuff		equ		RR10
                           A    56    		vBuffH		equ		R10
                           A    57    		vBuffL		equ		R11
                           A    58    		isrVect		equ		RR14
                           A    59    		isrVectH	equ		R14
                           A    60    		isrVectL	equ		R15
                           A    61    		hCharCnt	equ		R12
                           A    62    		vLineCnt	equ		R13
                           A    63    		state		equ		R9
                           A    64    
0002 0200                  A    65    vector	RESET = init
000C 0276                  A    66    vector timer0 = isrT0
                           A    67    org 0200h
0200 8F                    A    68    init		di									0201 0100                  A    69    			srp		#00h						0203 E9000FFE              A    70    			ldx		SPH,#00h					0207 E9FF0FFF              A    71    			ldx		SPL,#FFh
                           A    72    
020B E9010FD8              A    73    initSpi		ldx		PCADDR,#DDR					020F E9EF0FD9              A    74    			ldx		PCCTL,#~(1<<4)
0213 E9020FD8              A    75    			ldx		PCADDR,#AF					0217 E9100FD9              A    76    			ldx		PCCTL,#(1<<4)				021B E9030F61              A    77    			ldx		SPICTL,#(1<<1)|(1<<0)		021F E9000F63              A    78    			ldx		SPIMODE,#((cWidth & 7) << 2
0223 E9000F66              A    79    			ldx		SPIBRH,#HIGH(spiPre)		0227 E9020F67              A    80    			ldx		SPIBRL,#LOW(spiPre)
                           A    81    
022B E9000F07              A    82    			ldx		T0CTL1,#0					022F E9000F06              A    83    			ldx		T0CTL0,#0					0233 E9000F02              A    84    			ldx		T0RH,#HIGH(t0Interval)		0237 E92A0F03              A    85    			ldx		T0RL,#LOW(t0Interval)		023B E9010F07              A    86    			ldx		T0CTL1,#(1<<0)				023F E9200FC1              A    87    			ldx		IRQ0ENH,#(1<<5)				0243 E9200FC2              A    88    			ldx		IRQ0ENL,#(1<<5)
                           A    89    			
0247 E9000F0F              A    90    			ldx		T1CTL1,#0					024B E9000F0E              A    91    			ldx		T1CTL0,#0					024F E9000F0A              A    92    			ldx		T1RH,#HIGH(t1hSync)			0253 E9500F0B              A    93    			ldx		T1RL,#LOW(t1hSync)
0257 E9400F0F              A    94    			ldx		T1CTL1,#(1<<6)				                           A    95    
025B E9020FD8              A    96    initGPIO	ldx		PCADDR,#AF					Zilog eZ8 Encore! Macro Assembler Version 2.53 (14010603) 03-May-15     22:14:18     page:   3


PC     Object              I  Line    Source C:\users\koen\MY_D~D41\src\ez8\MONO~MM3\monovideo4.asm
025F 49020FD9              A    97    			orx		PCCTL,#(1<<1)			
                           A    98    			
0263 0CFF                  A    99    startVideo	ld		R0,#255
0265 9C 12                 A   100    			ld		state,#LOW(preEq)			0267 CC0F                  A   101    			ld		hCharCnt,#hCharsTotal/2
0269 DC06                  A   102    			ld		vLineCnt,#vSyncHLines + vSy
026B EC 03                 A   103    			ld		isrVectH,#HIGH(sync)
026D FC 00                 A   104    			ld		isrVectL,#LOW(sync)
026F 49800F07              A   105    			orx		T0CTL1,#(1<<7)				0273 9F                    A   106    			ei									0274                       A   107    $$			; Do stuff
0274 8B FE                 A   108    			jr		$B
                           A   109    
0276 C4EE                  A   110    isrT0		jp		@isrVect
                           A   111    
                           A   112    align 256
0300 59BF0F0F              A   113    sync		andx	T1CTL1,#~(1<<6)				0304 49800F0F              A   114    			orx		T1CTL1,#(1<<7)
0308 49400F0F              A   115    			orx		T1CTL1,#(1<<6)
030C E4E9EF                A   116    			ld		isrVectL,state
030F BCFF                  A   117    			ld		vBuffL,#FFh					0311 BF                    A   118    			iret
                           A   119    ; Pre-equalizing pulses
0312 CA 10                 A   120    preEq		djnz	hCharCnt,preEqEnd
0314 DA 0A                 A   121    			djnz	vLineCnt,$F
0316 9C 25                 A   122    			ld		state,#LOW(fetch)			0318 E4E0ED                A   123    			ld		vLineCnt,R0
031B CC1E                  A   124    			ld		hCharCnt,#hCharsTotal
031D FC 00                 A   125    			ld		isrVectL,#LOW(sync)
031F BF                    A   126    			iret
0320 CC0F                  A   127    $$			ld		hCharCnt,#hCharsTotal/2
0322 FC 00                 A   128    			ld		isrVectL,#LOW(sync)
0324 BF                    A   129    preEqEnd	iret
                           A   130    ; Visible display
0325 94BF60                A   131    fetch		ldx		SPIDATA,vBuffL
0328 CA 0F                 A   132    			djnz	hCharCnt,fetchTile
032A DA 09                 A   133    			djnz	vLineCnt,$F
032C 9C 3D                 A   134    			ld		state,#LOW(postEq)			032E DC05                  A   135    			ld		vLineCnt,#vSyncHLines
0330 CC0F                  A   136    			ld		hCharCnt,#hCharsTotal/2
0332 FC 00                 A   137    			ld		isrVectL,#LOW(sync)
0334 BF                    A   138    			iret
0335 CC1E                  A   139    $$			ld		hCharCnt,#hCharsTotal
0337 FC 00                 A   140    			ld		isrVectL,#LOW(sync)
0339 E4EDEB                A   141    fetchTile	ld		vBuffL,vLineCnt				033C BF                    A   142    			iret
                           A   143    ; Post-equalizing pulses
033D CA 12                 A   144    postEq		djnz	hCharCnt,postEqEnd
033F DA 0C                 A   145    			djnz	vLineCnt,$F
0341 9C 52                 A   146    			ld		state,#LOW(vSync)			0343 DC05                  A   147    			ld		vLineCnt,#vSyncHLines
0345 E9020F0A              A   148    			ldx		T1RH,#HIGH(t1BroadSync)		Zilog eZ8 Encore! Macro Assembler Version 2.53 (14010603) 03-May-15     22:14:18     page:   4


PC     Object              I  Line    Source C:\users\koen\MY_D~D41\src\ez8\MONO~MM3\monovideo4.asm
0349 E9260F0B              A   149    			ldx		T1RL,#LOW(t1BroadSync)
034D CC0F                  A   150    $$			ld		hCharCnt,#hCharsTotal/2
034F FC 00                 A   151    			ld		isrVectL,#LOW(sync)
0351 BF                    A   152    postEqEnd	iret
                           A   153    ; Broad sync pulses
0352 CA 12                 A   154    vSync		djnz	hCharCnt,vSyncEnd
0354 DA 0C                 A   155    			djnz	vLineCnt,$F
0356 9C 12                 A   156    			ld		state,#LOW(preEq)			0358 DC06                  A   157    			ld		vLineCnt,#vSyncHLines + vSy
035A E9000F0A              A   158    			ldx		T1RH,#HIGH(t1hSync)			035E E9500F0B              A   159    			ldx		T1RL,#LOW(t1hSync)
0362 CC0F                  A   160    $$			ld		hCharCnt,#hCharsTotal/2
0364 FC 00                 A   161    			ld		isrVectL,#LOW(sync)
0366 BF                    A   162    vSyncEnd	iret
                           A   163    
                           A   164    
                           A   165    if vSync - preEq > 200
-----WARNING (507) Unexpected relocatable boolean/relational operand(s)
                           A   166    	warning "vSync label almost out of reach!"
                           A   167    endif
                           A   168    			


Errors: 0
Warnings: 1
Lines Assembled: 2278
